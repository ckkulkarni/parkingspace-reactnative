{"version":3,"names":["PaymentScreen","route","navigation","useNavigation","params","spaces","space","details","markSpaceAsUnoccupied","useState","parkingCharge","setCharges","timeSpent","setTimeSpent","useEffect","calculateCharges","updateTimeSpent","timeDiff","Date","getTime","parse","time","hours","Math","abs","ceil","twoHourCharge","extra","floor","minutes","timeSpentString","handlePayment","registration","reg","charge","resultSet","fetch","method","headers","body","JSON","stringify","ok","Alert","alert","goBack","error","console","log","styles","container","StyleSheet","create","flex","alignItems","justifyContent"],"sources":["PaymentScreen.tsx"],"sourcesContent":["import axios from 'axios';\r\nimport React, {useState, useEffect} from 'react';\r\nimport {View, Text, StyleSheet, Alert, Button} from 'react-native';\r\nimport {useNavigation} from '@react-navigation/native';\r\nimport {NativeStackNavigationProp} from '@react-navigation/native-stack';\r\n\r\nexport default function PaymentScreen({route}: any) {\r\n  const navigation = useNavigation<NativeStackNavigationProp<any>>();\r\n  const {spaces, space, details, markSpaceAsUnoccupied} = route.params;\r\n  const [parkingCharge, setCharges] = useState<number>();\r\n  const [timeSpent, setTimeSpent] = useState<string>('');\r\n\r\n  useEffect(() => {\r\n    calculateCharges();\r\n    updateTimeSpent();\r\n  }, []);\r\n  function calculateCharges() {\r\n    const timeDiff = new Date().getTime() - Date.parse(details.time);\r\n    const hours = Math.abs(Math.ceil(timeDiff / (1000 * 3600)));\r\n    const twoHourCharge = 10;\r\n    let extra = 0;\r\n    if (hours > 2) {\r\n      extra = (hours - 2) * 10;\r\n    }\r\n    setCharges(twoHourCharge + extra);\r\n  }\r\n\r\n  function updateTimeSpent() {\r\n    const timeDiff = new Date().getTime() - Date.parse(details.time);\r\n    const hours = Math.abs(Math.floor(timeDiff / (1000 * 3600)));\r\n    const minutes = Math.abs(\r\n      Math.floor((timeDiff % (1000 * 3600)) / (1000 * 60)),\r\n    );\r\n    const timeSpentString = `${hours} hours ${minutes} minutes`;\r\n    setTimeSpent(timeSpentString);\r\n  }\r\n\r\n  async function handlePayment() {\r\n    const registration = details.reg;\r\n    const charge = parkingCharge;\r\n    try {\r\n      const resultSet = await fetch(`https://httpstat.us/200`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          'car-registration': registration,\r\n          charge: charge,\r\n        }),\r\n      });\r\n      if (resultSet.ok) {\r\n        Alert.alert(`Payment Sucessful`);\r\n        markSpaceAsUnoccupied(space);\r\n        navigation.goBack();\r\n      } else {\r\n        Alert.alert('Payment Failed');\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  }\r\n  return (\r\n    <View style={styles.container}>\r\n      {details && (\r\n        <View>\r\n          <Button\r\n            title=\"Go Back\"\r\n            onPress={() => {\r\n              navigation.goBack();\r\n            }}\r\n            testID=\"deregester-back\"\r\n          />\r\n          <Text>Car Registration: {details.reg}</Text>\r\n          <Text testID=\"deregester-time-spent\">Time Spent: {timeSpent}</Text>\r\n          <Text testID=\"deregester-charge\">\r\n            Parking Charges: ${parkingCharge}\r\n          </Text>\r\n          <Button\r\n            title=\"Payment Taken\"\r\n            onPress={handlePayment}\r\n            testID=\"deregester-payment-button\"\r\n          />\r\n        </View>\r\n      )}\r\n    </View>\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n});\r\n"],"mappings":"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"}