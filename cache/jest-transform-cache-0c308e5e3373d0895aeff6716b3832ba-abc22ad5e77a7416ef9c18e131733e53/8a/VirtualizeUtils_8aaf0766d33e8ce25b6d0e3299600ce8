5ec3341aff7464598c99a2dcef616aa3
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.computeWindowedRenderLimits = computeWindowedRenderLimits;
exports.elementsThatOverlapOffsets = elementsThatOverlapOffsets;
exports.keyExtractor = keyExtractor;
exports.newRangeCount = newRangeCount;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
function elementsThatOverlapOffsets(offsets, props, getFrameMetrics) {
  var zoomScale = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
  var itemCount = props.getItemCount(props.data);
  var result = [];
  for (var offsetIndex = 0; offsetIndex < offsets.length; offsetIndex++) {
    var currentOffset = offsets[offsetIndex];
    var left = 0;
    var right = itemCount - 1;
    while (left <= right) {
      var mid = left + (right - left >>> 1);
      var frame = getFrameMetrics(mid, props);
      var scaledOffsetStart = frame.offset * zoomScale;
      var scaledOffsetEnd = (frame.offset + frame.length) * zoomScale;
      if (mid === 0 && currentOffset < scaledOffsetStart || mid !== 0 && currentOffset <= scaledOffsetStart) {
        right = mid - 1;
      } else if (currentOffset > scaledOffsetEnd) {
        left = mid + 1;
      } else {
        result[offsetIndex] = mid;
        break;
      }
    }
  }
  return result;
}
function newRangeCount(prev, next) {
  return next.last - next.first + 1 - Math.max(0, 1 + Math.min(next.last, prev.last) - Math.max(next.first, prev.first));
}
function computeWindowedRenderLimits(props, maxToRenderPerBatch, windowSize, prev, getFrameMetricsApprox, scrollMetrics) {
  var itemCount = props.getItemCount(props.data);
  if (itemCount === 0) {
    return {
      first: 0,
      last: -1
    };
  }
  var offset = scrollMetrics.offset,
    velocity = scrollMetrics.velocity,
    visibleLength = scrollMetrics.visibleLength,
    _scrollMetrics$zoomSc = scrollMetrics.zoomScale,
    zoomScale = _scrollMetrics$zoomSc === void 0 ? 1 : _scrollMetrics$zoomSc;
  var visibleBegin = Math.max(0, offset);
  var visibleEnd = visibleBegin + visibleLength;
  var overscanLength = (windowSize - 1) * visibleLength;
  var leadFactor = 0.5;
  var fillPreference = velocity > 1 ? 'after' : velocity < -1 ? 'before' : 'none';
  var overscanBegin = Math.max(0, visibleBegin - (1 - leadFactor) * overscanLength);
  var overscanEnd = Math.max(0, visibleEnd + leadFactor * overscanLength);
  var lastItemOffset = getFrameMetricsApprox(itemCount - 1, props).offset * zoomScale;
  if (lastItemOffset < overscanBegin) {
    return {
      first: Math.max(0, itemCount - 1 - maxToRenderPerBatch),
      last: itemCount - 1
    };
  }
  var _elementsThatOverlapO = elementsThatOverlapOffsets([overscanBegin, visibleBegin, visibleEnd, overscanEnd], props, getFrameMetricsApprox, zoomScale),
    _elementsThatOverlapO2 = (0, _slicedToArray2.default)(_elementsThatOverlapO, 4),
    overscanFirst = _elementsThatOverlapO2[0],
    first = _elementsThatOverlapO2[1],
    last = _elementsThatOverlapO2[2],
    overscanLast = _elementsThatOverlapO2[3];
  overscanFirst = overscanFirst == null ? 0 : overscanFirst;
  first = first == null ? Math.max(0, overscanFirst) : first;
  overscanLast = overscanLast == null ? itemCount - 1 : overscanLast;
  last = last == null ? Math.min(overscanLast, first + maxToRenderPerBatch - 1) : last;
  var visible = {
    first: first,
    last: last
  };
  var newCellCount = newRangeCount(prev, visible);
  while (true) {
    if (first <= overscanFirst && last >= overscanLast) {
      break;
    }
    var maxNewCells = newCellCount >= maxToRenderPerBatch;
    var firstWillAddMore = first <= prev.first || first > prev.last;
    var firstShouldIncrement = first > overscanFirst && (!maxNewCells || !firstWillAddMore);
    var lastWillAddMore = last >= prev.last || last < prev.first;
    var lastShouldIncrement = last < overscanLast && (!maxNewCells || !lastWillAddMore);
    if (maxNewCells && !firstShouldIncrement && !lastShouldIncrement) {
      break;
    }
    if (firstShouldIncrement && !(fillPreference === 'after' && lastShouldIncrement && lastWillAddMore)) {
      if (firstWillAddMore) {
        newCellCount++;
      }
      first--;
    }
    if (lastShouldIncrement && !(fillPreference === 'before' && firstShouldIncrement && firstWillAddMore)) {
      if (lastWillAddMore) {
        newCellCount++;
      }
      last++;
    }
  }
  if (!(last >= first && first >= 0 && last < itemCount && first >= overscanFirst && last <= overscanLast && first <= visible.first && last >= visible.last)) {
    throw new Error('Bad window calculation ' + JSON.stringify({
      first: first,
      last: last,
      itemCount: itemCount,
      overscanFirst: overscanFirst,
      overscanLast: overscanLast,
      visible: visible
    }));
  }
  return {
    first: first,
    last: last
  };
}
function keyExtractor(item, index) {
  if (typeof item === 'object' && (item == null ? void 0 : item.key) != null) {
    return item.key;
  }
  if (typeof item === 'object' && (item == null ? void 0 : item.id) != null) {
    return item.id;
  }
  return String(index);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJlbGVtZW50c1RoYXRPdmVybGFwT2Zmc2V0cyIsIm9mZnNldHMiLCJwcm9wcyIsImdldEZyYW1lTWV0cmljcyIsInpvb21TY2FsZSIsIml0ZW1Db3VudCIsImdldEl0ZW1Db3VudCIsImRhdGEiLCJyZXN1bHQiLCJvZmZzZXRJbmRleCIsImxlbmd0aCIsImN1cnJlbnRPZmZzZXQiLCJsZWZ0IiwicmlnaHQiLCJtaWQiLCJmcmFtZSIsInNjYWxlZE9mZnNldFN0YXJ0Iiwib2Zmc2V0Iiwic2NhbGVkT2Zmc2V0RW5kIiwibmV3UmFuZ2VDb3VudCIsInByZXYiLCJuZXh0IiwibGFzdCIsImZpcnN0IiwiTWF0aCIsIm1heCIsIm1pbiIsImNvbXB1dGVXaW5kb3dlZFJlbmRlckxpbWl0cyIsIm1heFRvUmVuZGVyUGVyQmF0Y2giLCJ3aW5kb3dTaXplIiwiZ2V0RnJhbWVNZXRyaWNzQXBwcm94Iiwic2Nyb2xsTWV0cmljcyIsInZlbG9jaXR5IiwidmlzaWJsZUxlbmd0aCIsInZpc2libGVCZWdpbiIsInZpc2libGVFbmQiLCJvdmVyc2Nhbkxlbmd0aCIsImxlYWRGYWN0b3IiLCJmaWxsUHJlZmVyZW5jZSIsIm92ZXJzY2FuQmVnaW4iLCJvdmVyc2NhbkVuZCIsImxhc3RJdGVtT2Zmc2V0Iiwib3ZlcnNjYW5GaXJzdCIsIm92ZXJzY2FuTGFzdCIsInZpc2libGUiLCJuZXdDZWxsQ291bnQiLCJtYXhOZXdDZWxscyIsImZpcnN0V2lsbEFkZE1vcmUiLCJmaXJzdFNob3VsZEluY3JlbWVudCIsImxhc3RXaWxsQWRkTW9yZSIsImxhc3RTaG91bGRJbmNyZW1lbnQiLCJFcnJvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJrZXlFeHRyYWN0b3IiLCJpdGVtIiwiaW5kZXgiLCJrZXkiLCJpZCIsIlN0cmluZyJdLCJzb3VyY2VzIjpbIlZpcnR1YWxpemVVdGlscy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgTWV0YSBQbGF0Zm9ybXMsIEluYy4gYW5kIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB0eXBlIHtGcmFtZU1ldHJpY1Byb3BzfSBmcm9tICcuL1ZpcnR1YWxpemVkTGlzdFByb3BzJztcblxuLyoqXG4gKiBVc2VkIHRvIGZpbmQgdGhlIGluZGljZXMgb2YgdGhlIGZyYW1lcyB0aGF0IG92ZXJsYXAgdGhlIGdpdmVuIG9mZnNldHMuIFVzZWZ1bCBmb3IgZmluZGluZyB0aGVcbiAqIGl0ZW1zIHRoYXQgYm91bmQgZGlmZmVyZW50IHdpbmRvd3Mgb2YgY29udGVudCwgc3VjaCBhcyB0aGUgdmlzaWJsZSBhcmVhIG9yIHRoZSBidWZmZXJlZCBvdmVyc2NhblxuICogYXJlYS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVsZW1lbnRzVGhhdE92ZXJsYXBPZmZzZXRzKFxuICBvZmZzZXRzOiBBcnJheTxudW1iZXI+LFxuICBwcm9wczogRnJhbWVNZXRyaWNQcm9wcyxcbiAgZ2V0RnJhbWVNZXRyaWNzOiAoXG4gICAgaW5kZXg6IG51bWJlcixcbiAgICBwcm9wczogRnJhbWVNZXRyaWNQcm9wcyxcbiAgKSA9PiB7XG4gICAgbGVuZ3RoOiBudW1iZXIsXG4gICAgb2Zmc2V0OiBudW1iZXIsXG4gICAgLi4uXG4gIH0sXG4gIHpvb21TY2FsZTogbnVtYmVyID0gMSxcbik6IEFycmF5PG51bWJlcj4ge1xuICBjb25zdCBpdGVtQ291bnQgPSBwcm9wcy5nZXRJdGVtQ291bnQocHJvcHMuZGF0YSk7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBmb3IgKGxldCBvZmZzZXRJbmRleCA9IDA7IG9mZnNldEluZGV4IDwgb2Zmc2V0cy5sZW5ndGg7IG9mZnNldEluZGV4KyspIHtcbiAgICBjb25zdCBjdXJyZW50T2Zmc2V0ID0gb2Zmc2V0c1tvZmZzZXRJbmRleF07XG4gICAgbGV0IGxlZnQgPSAwO1xuICAgIGxldCByaWdodCA9IGl0ZW1Db3VudCAtIDE7XG5cbiAgICB3aGlsZSAobGVmdCA8PSByaWdodCkge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWJpdHdpc2VcbiAgICAgIGNvbnN0IG1pZCA9IGxlZnQgKyAoKHJpZ2h0IC0gbGVmdCkgPj4+IDEpO1xuICAgICAgY29uc3QgZnJhbWUgPSBnZXRGcmFtZU1ldHJpY3MobWlkLCBwcm9wcyk7XG4gICAgICBjb25zdCBzY2FsZWRPZmZzZXRTdGFydCA9IGZyYW1lLm9mZnNldCAqIHpvb21TY2FsZTtcbiAgICAgIGNvbnN0IHNjYWxlZE9mZnNldEVuZCA9IChmcmFtZS5vZmZzZXQgKyBmcmFtZS5sZW5ndGgpICogem9vbVNjYWxlO1xuXG4gICAgICAvLyBXZSB3YW50IHRoZSBmaXJzdCBmcmFtZSB0aGF0IGNvbnRhaW5zIHRoZSBvZmZzZXQsIHdpdGggaW5jbHVzaXZlIGJvdW5kcy4gVGh1cywgZm9yIHRoZVxuICAgICAgLy8gZmlyc3QgZnJhbWUgdGhlIHNjYWxlZE9mZnNldFN0YXJ0IGlzIGluY2x1c2l2ZSwgd2hpbGUgZm9yIG90aGVyIGZyYW1lcyBpdCBpcyBleGNsdXNpdmUuXG4gICAgICBpZiAoXG4gICAgICAgIChtaWQgPT09IDAgJiYgY3VycmVudE9mZnNldCA8IHNjYWxlZE9mZnNldFN0YXJ0KSB8fFxuICAgICAgICAobWlkICE9PSAwICYmIGN1cnJlbnRPZmZzZXQgPD0gc2NhbGVkT2Zmc2V0U3RhcnQpXG4gICAgICApIHtcbiAgICAgICAgcmlnaHQgPSBtaWQgLSAxO1xuICAgICAgfSBlbHNlIGlmIChjdXJyZW50T2Zmc2V0ID4gc2NhbGVkT2Zmc2V0RW5kKSB7XG4gICAgICAgIGxlZnQgPSBtaWQgKyAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0W29mZnNldEluZGV4XSA9IG1pZDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiBDb21wdXRlcyB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIHRoZSBgbmV4dGAgcmFuZ2UgdGhhdCBhcmUgbmV3IGNvbXBhcmVkIHRvIHRoZSBgcHJldmAgcmFuZ2UuXG4gKiBIYW5keSBmb3IgY2FsY3VsYXRpbmcgaG93IG1hbnkgbmV3IGl0ZW1zIHdpbGwgYmUgcmVuZGVyZWQgd2hlbiB0aGUgcmVuZGVyIHdpbmRvdyBjaGFuZ2VzIHNvIHdlXG4gKiBjYW4gcmVzdHJpY3QgdGhlIG51bWJlciBvZiBuZXcgaXRlbXMgcmVuZGVyIGF0IG9uY2Ugc28gdGhhdCBjb250ZW50IGNhbiBhcHBlYXIgb24gdGhlIHNjcmVlblxuICogZmFzdGVyLlxuICovXG5leHBvcnQgZnVuY3Rpb24gbmV3UmFuZ2VDb3VudChcbiAgcHJldjoge1xuICAgIGZpcnN0OiBudW1iZXIsXG4gICAgbGFzdDogbnVtYmVyLFxuICAgIC4uLlxuICB9LFxuICBuZXh0OiB7XG4gICAgZmlyc3Q6IG51bWJlcixcbiAgICBsYXN0OiBudW1iZXIsXG4gICAgLi4uXG4gIH0sXG4pOiBudW1iZXIge1xuICByZXR1cm4gKFxuICAgIG5leHQubGFzdCAtXG4gICAgbmV4dC5maXJzdCArXG4gICAgMSAtXG4gICAgTWF0aC5tYXgoXG4gICAgICAwLFxuICAgICAgMSArIE1hdGgubWluKG5leHQubGFzdCwgcHJldi5sYXN0KSAtIE1hdGgubWF4KG5leHQuZmlyc3QsIHByZXYuZmlyc3QpLFxuICAgIClcbiAgKTtcbn1cblxuLyoqXG4gKiBDdXN0b20gbG9naWMgZm9yIGRldGVybWluaW5nIHdoaWNoIGl0ZW1zIHNob3VsZCBiZSByZW5kZXJlZCBnaXZlbiB0aGUgY3VycmVudCBmcmFtZSBhbmQgc2Nyb2xsXG4gKiBtZXRyaWNzLCBhcyB3ZWxsIGFzIHRoZSBwcmV2aW91cyByZW5kZXIgc3RhdGUuIFRoZSBhbGdvcml0aG0gbWF5IGV2b2x2ZSBvdmVyIHRpbWUsIGJ1dCBnZW5lcmFsbHlcbiAqIHByaW9yaXRpemVzIHRoZSB2aXNpYmxlIGFyZWEgZmlyc3QsIHRoZW4gZXhwYW5kcyB0aGF0IHdpdGggb3ZlcnNjYW4gcmVnaW9ucyBhaGVhZCBhbmQgYmVoaW5kLFxuICogYmlhc2VkIGluIHRoZSBkaXJlY3Rpb24gb2Ygc2Nyb2xsLlxuICovXG5leHBvcnQgZnVuY3Rpb24gY29tcHV0ZVdpbmRvd2VkUmVuZGVyTGltaXRzKFxuICBwcm9wczogRnJhbWVNZXRyaWNQcm9wcyxcbiAgbWF4VG9SZW5kZXJQZXJCYXRjaDogbnVtYmVyLFxuICB3aW5kb3dTaXplOiBudW1iZXIsXG4gIHByZXY6IHtcbiAgICBmaXJzdDogbnVtYmVyLFxuICAgIGxhc3Q6IG51bWJlcixcbiAgfSxcbiAgZ2V0RnJhbWVNZXRyaWNzQXBwcm94OiAoXG4gICAgaW5kZXg6IG51bWJlcixcbiAgICBwcm9wczogRnJhbWVNZXRyaWNQcm9wcyxcbiAgKSA9PiB7XG4gICAgbGVuZ3RoOiBudW1iZXIsXG4gICAgb2Zmc2V0OiBudW1iZXIsXG4gICAgLi4uXG4gIH0sXG4gIHNjcm9sbE1ldHJpY3M6IHtcbiAgICBkdDogbnVtYmVyLFxuICAgIG9mZnNldDogbnVtYmVyLFxuICAgIHZlbG9jaXR5OiBudW1iZXIsXG4gICAgdmlzaWJsZUxlbmd0aDogbnVtYmVyLFxuICAgIHpvb21TY2FsZTogbnVtYmVyLFxuICAgIC4uLlxuICB9LFxuKToge1xuICBmaXJzdDogbnVtYmVyLFxuICBsYXN0OiBudW1iZXIsXG59IHtcbiAgY29uc3QgaXRlbUNvdW50ID0gcHJvcHMuZ2V0SXRlbUNvdW50KHByb3BzLmRhdGEpO1xuICBpZiAoaXRlbUNvdW50ID09PSAwKSB7XG4gICAgcmV0dXJuIHtmaXJzdDogMCwgbGFzdDogLTF9O1xuICB9XG4gIGNvbnN0IHtvZmZzZXQsIHZlbG9jaXR5LCB2aXNpYmxlTGVuZ3RoLCB6b29tU2NhbGUgPSAxfSA9IHNjcm9sbE1ldHJpY3M7XG5cbiAgLy8gU3RhcnQgd2l0aCB2aXNpYmxlIGFyZWEsIHRoZW4gY29tcHV0ZSBtYXhpbXVtIG92ZXJzY2FuIHJlZ2lvbiBieSBleHBhbmRpbmcgZnJvbSB0aGVyZSwgYmlhc2VkXG4gIC8vIGluIHRoZSBkaXJlY3Rpb24gb2Ygc2Nyb2xsLiBUb3RhbCBvdmVyc2NhbiBhcmVhIGlzIGNhcHBlZCwgd2hpY2ggc2hvdWxkIGNhcCBtZW1vcnkgY29uc3VtcHRpb25cbiAgLy8gdG9vLlxuICBjb25zdCB2aXNpYmxlQmVnaW4gPSBNYXRoLm1heCgwLCBvZmZzZXQpO1xuICBjb25zdCB2aXNpYmxlRW5kID0gdmlzaWJsZUJlZ2luICsgdmlzaWJsZUxlbmd0aDtcbiAgY29uc3Qgb3ZlcnNjYW5MZW5ndGggPSAod2luZG93U2l6ZSAtIDEpICogdmlzaWJsZUxlbmd0aDtcblxuICAvLyBDb25zaWRlcmluZyB2ZWxvY2l0eSBzZWVtcyB0byBpbnRyb2R1Y2UgbW9yZSBjaHVybiB0aGFuIGl0J3Mgd29ydGguXG4gIGNvbnN0IGxlYWRGYWN0b3IgPSAwLjU7IC8vIE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHZlbG9jaXR5IC8gMjUgKyAwLjUpKTtcblxuICBjb25zdCBmaWxsUHJlZmVyZW5jZSA9XG4gICAgdmVsb2NpdHkgPiAxID8gJ2FmdGVyJyA6IHZlbG9jaXR5IDwgLTEgPyAnYmVmb3JlJyA6ICdub25lJztcblxuICBjb25zdCBvdmVyc2NhbkJlZ2luID0gTWF0aC5tYXgoXG4gICAgMCxcbiAgICB2aXNpYmxlQmVnaW4gLSAoMSAtIGxlYWRGYWN0b3IpICogb3ZlcnNjYW5MZW5ndGgsXG4gICk7XG4gIGNvbnN0IG92ZXJzY2FuRW5kID0gTWF0aC5tYXgoMCwgdmlzaWJsZUVuZCArIGxlYWRGYWN0b3IgKiBvdmVyc2Nhbkxlbmd0aCk7XG5cbiAgY29uc3QgbGFzdEl0ZW1PZmZzZXQgPVxuICAgIGdldEZyYW1lTWV0cmljc0FwcHJveChpdGVtQ291bnQgLSAxLCBwcm9wcykub2Zmc2V0ICogem9vbVNjYWxlO1xuICBpZiAobGFzdEl0ZW1PZmZzZXQgPCBvdmVyc2NhbkJlZ2luKSB7XG4gICAgLy8gRW50aXJlIGxpc3QgaXMgYmVmb3JlIG91ciBvdmVyc2NhbiB3aW5kb3dcbiAgICByZXR1cm4ge1xuICAgICAgZmlyc3Q6IE1hdGgubWF4KDAsIGl0ZW1Db3VudCAtIDEgLSBtYXhUb1JlbmRlclBlckJhdGNoKSxcbiAgICAgIGxhc3Q6IGl0ZW1Db3VudCAtIDEsXG4gICAgfTtcbiAgfVxuXG4gIC8vIEZpbmQgdGhlIGluZGljZXMgdGhhdCBjb3JyZXNwb25kIHRvIHRoZSBpdGVtcyBhdCB0aGUgcmVuZGVyIGJvdW5kYXJpZXMgd2UncmUgdGFyZ2V0aW5nLlxuICBsZXQgW292ZXJzY2FuRmlyc3QsIGZpcnN0LCBsYXN0LCBvdmVyc2Nhbkxhc3RdID0gZWxlbWVudHNUaGF0T3ZlcmxhcE9mZnNldHMoXG4gICAgW292ZXJzY2FuQmVnaW4sIHZpc2libGVCZWdpbiwgdmlzaWJsZUVuZCwgb3ZlcnNjYW5FbmRdLFxuICAgIHByb3BzLFxuICAgIGdldEZyYW1lTWV0cmljc0FwcHJveCxcbiAgICB6b29tU2NhbGUsXG4gICk7XG4gIG92ZXJzY2FuRmlyc3QgPSBvdmVyc2NhbkZpcnN0ID09IG51bGwgPyAwIDogb3ZlcnNjYW5GaXJzdDtcbiAgZmlyc3QgPSBmaXJzdCA9PSBudWxsID8gTWF0aC5tYXgoMCwgb3ZlcnNjYW5GaXJzdCkgOiBmaXJzdDtcbiAgb3ZlcnNjYW5MYXN0ID0gb3ZlcnNjYW5MYXN0ID09IG51bGwgPyBpdGVtQ291bnQgLSAxIDogb3ZlcnNjYW5MYXN0O1xuICBsYXN0ID1cbiAgICBsYXN0ID09IG51bGxcbiAgICAgID8gTWF0aC5taW4ob3ZlcnNjYW5MYXN0LCBmaXJzdCArIG1heFRvUmVuZGVyUGVyQmF0Y2ggLSAxKVxuICAgICAgOiBsYXN0O1xuICBjb25zdCB2aXNpYmxlID0ge2ZpcnN0LCBsYXN0fTtcblxuICAvLyBXZSB3YW50IHRvIGxpbWl0IHRoZSBudW1iZXIgb2YgbmV3IGNlbGxzIHdlJ3JlIHJlbmRlcmluZyBwZXIgYmF0Y2ggc28gdGhhdCB3ZSBjYW4gZmlsbCB0aGVcbiAgLy8gY29udGVudCBvbiB0aGUgc2NyZWVuIHF1aWNrbHkuIElmIHdlIHJlbmRlcmVkIHRoZSBlbnRpcmUgb3ZlcnNjYW4gd2luZG93IGF0IG9uY2UsIHRoZSB1c2VyXG4gIC8vIGNvdWxkIGJlIHN0YXJpbmcgYXQgd2hpdGUgc3BhY2UgZm9yIGEgbG9uZyB0aW1lIHdhaXRpbmcgZm9yIGEgYnVuY2ggb2Ygb2Zmc2NyZWVuIGNvbnRlbnQgdG9cbiAgLy8gcmVuZGVyLlxuICBsZXQgbmV3Q2VsbENvdW50ID0gbmV3UmFuZ2VDb3VudChwcmV2LCB2aXNpYmxlKTtcblxuICB3aGlsZSAodHJ1ZSkge1xuICAgIGlmIChmaXJzdCA8PSBvdmVyc2NhbkZpcnN0ICYmIGxhc3QgPj0gb3ZlcnNjYW5MYXN0KSB7XG4gICAgICAvLyBJZiB3ZSBmaWxsIHRoZSBlbnRpcmUgb3ZlcnNjYW4gcmFuZ2UsIHdlJ3JlIGRvbmUuXG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY29uc3QgbWF4TmV3Q2VsbHMgPSBuZXdDZWxsQ291bnQgPj0gbWF4VG9SZW5kZXJQZXJCYXRjaDtcbiAgICBjb25zdCBmaXJzdFdpbGxBZGRNb3JlID0gZmlyc3QgPD0gcHJldi5maXJzdCB8fCBmaXJzdCA+IHByZXYubGFzdDtcbiAgICBjb25zdCBmaXJzdFNob3VsZEluY3JlbWVudCA9XG4gICAgICBmaXJzdCA+IG92ZXJzY2FuRmlyc3QgJiYgKCFtYXhOZXdDZWxscyB8fCAhZmlyc3RXaWxsQWRkTW9yZSk7XG4gICAgY29uc3QgbGFzdFdpbGxBZGRNb3JlID0gbGFzdCA+PSBwcmV2Lmxhc3QgfHwgbGFzdCA8IHByZXYuZmlyc3Q7XG4gICAgY29uc3QgbGFzdFNob3VsZEluY3JlbWVudCA9XG4gICAgICBsYXN0IDwgb3ZlcnNjYW5MYXN0ICYmICghbWF4TmV3Q2VsbHMgfHwgIWxhc3RXaWxsQWRkTW9yZSk7XG4gICAgaWYgKG1heE5ld0NlbGxzICYmICFmaXJzdFNob3VsZEluY3JlbWVudCAmJiAhbGFzdFNob3VsZEluY3JlbWVudCkge1xuICAgICAgLy8gV2Ugb25seSB3YW50IHRvIHN0b3AgaWYgd2UndmUgaGl0IG1heE5ld0NlbGxzIEFORCB3ZSBjYW5ub3QgaW5jcmVtZW50IGZpcnN0IG9yIGxhc3RcbiAgICAgIC8vIHdpdGhvdXQgcmVuZGVyaW5nIG5ldyBpdGVtcy4gVGhpcyBsZXQncyB1cyBwcmVzZXJ2ZSBhcyBtYW55IGFscmVhZHkgcmVuZGVyZWQgaXRlbXMgYXNcbiAgICAgIC8vIHBvc3NpYmxlLCByZWR1Y2luZyByZW5kZXIgY2h1cm4gYW5kIGtlZXBpbmcgdGhlIHJlbmRlcmVkIG92ZXJzY2FuIHJhbmdlIGFzIGxhcmdlIGFzXG4gICAgICAvLyBwb3NzaWJsZS5cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICBmaXJzdFNob3VsZEluY3JlbWVudCAmJlxuICAgICAgIShmaWxsUHJlZmVyZW5jZSA9PT0gJ2FmdGVyJyAmJiBsYXN0U2hvdWxkSW5jcmVtZW50ICYmIGxhc3RXaWxsQWRkTW9yZSlcbiAgICApIHtcbiAgICAgIGlmIChmaXJzdFdpbGxBZGRNb3JlKSB7XG4gICAgICAgIG5ld0NlbGxDb3VudCsrO1xuICAgICAgfVxuICAgICAgZmlyc3QtLTtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgbGFzdFNob3VsZEluY3JlbWVudCAmJlxuICAgICAgIShmaWxsUHJlZmVyZW5jZSA9PT0gJ2JlZm9yZScgJiYgZmlyc3RTaG91bGRJbmNyZW1lbnQgJiYgZmlyc3RXaWxsQWRkTW9yZSlcbiAgICApIHtcbiAgICAgIGlmIChsYXN0V2lsbEFkZE1vcmUpIHtcbiAgICAgICAgbmV3Q2VsbENvdW50Kys7XG4gICAgICB9XG4gICAgICBsYXN0Kys7XG4gICAgfVxuICB9XG4gIGlmIChcbiAgICAhKFxuICAgICAgbGFzdCA+PSBmaXJzdCAmJlxuICAgICAgZmlyc3QgPj0gMCAmJlxuICAgICAgbGFzdCA8IGl0ZW1Db3VudCAmJlxuICAgICAgZmlyc3QgPj0gb3ZlcnNjYW5GaXJzdCAmJlxuICAgICAgbGFzdCA8PSBvdmVyc2Nhbkxhc3QgJiZcbiAgICAgIGZpcnN0IDw9IHZpc2libGUuZmlyc3QgJiZcbiAgICAgIGxhc3QgPj0gdmlzaWJsZS5sYXN0XG4gICAgKVxuICApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnQmFkIHdpbmRvdyBjYWxjdWxhdGlvbiAnICtcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGZpcnN0LFxuICAgICAgICAgIGxhc3QsXG4gICAgICAgICAgaXRlbUNvdW50LFxuICAgICAgICAgIG92ZXJzY2FuRmlyc3QsXG4gICAgICAgICAgb3ZlcnNjYW5MYXN0LFxuICAgICAgICAgIHZpc2libGUsXG4gICAgICAgIH0pLFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHtmaXJzdCwgbGFzdH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBrZXlFeHRyYWN0b3IoaXRlbTogYW55LCBpbmRleDogbnVtYmVyKTogc3RyaW5nIHtcbiAgaWYgKHR5cGVvZiBpdGVtID09PSAnb2JqZWN0JyAmJiBpdGVtPy5rZXkgIT0gbnVsbCkge1xuICAgIHJldHVybiBpdGVtLmtleTtcbiAgfVxuICBpZiAodHlwZW9mIGl0ZW0gPT09ICdvYmplY3QnICYmIGl0ZW0/LmlkICE9IG51bGwpIHtcbiAgICByZXR1cm4gaXRlbS5pZDtcbiAgfVxuICByZXR1cm4gU3RyaW5nKGluZGV4KTtcbn1cbiJdLCJtYXBwaW5ncyI6IkFBVUEsWUFBWTs7QUFBQztBQUFBO0VBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFTTixTQUFTQSwwQkFBMEIsQ0FDeENDLE9BQXNCLEVBQ3RCQyxLQUF1QixFQUN2QkMsZUFPQyxFQUVjO0VBQUEsSUFEZkMsU0FBaUIsdUVBQUcsQ0FBQztFQUVyQixJQUFNQyxTQUFTLEdBQUdILEtBQUssQ0FBQ0ksWUFBWSxDQUFDSixLQUFLLENBQUNLLElBQUks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