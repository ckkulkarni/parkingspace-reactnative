{"version":3,"names":["CellRenderer","state","separatorProps","highlighted","leadingItem","props","item","_separators","highlight","cellKey","prevCellKey","onUpdateSeparators","unhighlight","updateProps","select","newProps","_onLayout","nativeEvent","onCellLayout","index","setState","onUnmount","renderItem","ListItemComponent","console","warn","React","createElement","separators","invariant","CellRendererComponent","ItemSeparatorComponent","debug","fillRateHelper","getItemLayout","horizontal","inversionStyle","onCellFocusCapture","element","_renderElement","onLayout","enabled","undefined","itemSeparator","isValidElement","cellStyle","styles","rowReverse","columnReverse","row","result","prevState","Component","StyleSheet","create","flexDirection"],"sources":["VirtualizedListCellRenderer.js"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n * @format\n */\n\nimport type {ViewStyleProp} from '../StyleSheet/StyleSheet';\nimport type {FocusEvent, LayoutEvent} from '../Types/CoreEventTypes';\nimport type FillRateHelper from './FillRateHelper';\nimport type {RenderItemType} from './VirtualizedListProps';\n\nimport View from '../Components/View/View';\nimport StyleSheet from '../StyleSheet/StyleSheet';\nimport {VirtualizedListCellContextProvider} from './VirtualizedListContext.js';\nimport invariant from 'invariant';\nimport * as React from 'react';\n\nexport type Props<ItemT> = {\n  CellRendererComponent?: ?React.ComponentType<any>,\n  ItemSeparatorComponent: ?React.ComponentType<\n    any | {highlighted: boolean, leadingItem: ?ItemT},\n  >,\n  ListItemComponent?: ?(React.ComponentType<any> | React.Element<any>),\n  cellKey: string,\n  debug?: ?boolean,\n  fillRateHelper: FillRateHelper,\n  getItemLayout?: (\n    data: any,\n    index: number,\n  ) => {\n    length: number,\n    offset: number,\n    index: number,\n    ...\n  },\n  horizontal: ?boolean,\n  index: number,\n  inversionStyle: ViewStyleProp,\n  item: ItemT,\n  onCellLayout: (event: LayoutEvent, cellKey: string, index: number) => void,\n  onCellFocusCapture?: (event: FocusEvent) => void,\n  onUnmount: (cellKey: string) => void,\n  onUpdateSeparators: (\n    cellKeys: Array<?string>,\n    props: $Shape<SeparatorProps<ItemT>>,\n  ) => void,\n  prevCellKey: ?string,\n  renderItem?: ?RenderItemType<ItemT>,\n  ...\n};\n\ntype SeparatorProps<ItemT> = $ReadOnly<{|\n  highlighted: boolean,\n  leadingItem: ?ItemT,\n|}>;\n\ntype State<ItemT> = {\n  separatorProps: SeparatorProps<ItemT>,\n  ...\n};\n\nexport default class CellRenderer<ItemT> extends React.Component<\n  Props<ItemT>,\n  State<ItemT>,\n> {\n  state: State<ItemT> = {\n    separatorProps: {\n      highlighted: false,\n      leadingItem: this.props.item,\n    },\n  };\n\n  static getDerivedStateFromProps(\n    props: Props<ItemT>,\n    prevState: State<ItemT>,\n  ): ?State<ItemT> {\n    return {\n      separatorProps: {\n        ...prevState.separatorProps,\n        leadingItem: props.item,\n      },\n    };\n  }\n\n  // TODO: consider factoring separator stuff out of VirtualizedList into FlatList since it's not\n  // reused by SectionList and we can keep VirtualizedList simpler.\n  // $FlowFixMe[missing-local-annot]\n  _separators = {\n    highlight: () => {\n      const {cellKey, prevCellKey} = this.props;\n      this.props.onUpdateSeparators([cellKey, prevCellKey], {\n        highlighted: true,\n      });\n    },\n    unhighlight: () => {\n      const {cellKey, prevCellKey} = this.props;\n      this.props.onUpdateSeparators([cellKey, prevCellKey], {\n        highlighted: false,\n      });\n    },\n    updateProps: (\n      select: 'leading' | 'trailing',\n      newProps: SeparatorProps<ItemT>,\n    ) => {\n      const {cellKey, prevCellKey} = this.props;\n      this.props.onUpdateSeparators(\n        [select === 'leading' ? prevCellKey : cellKey],\n        newProps,\n      );\n    },\n  };\n\n  updateSeparatorProps(newProps: SeparatorProps<ItemT>) {\n    this.setState(state => ({\n      separatorProps: {...state.separatorProps, ...newProps},\n    }));\n  }\n\n  componentWillUnmount() {\n    this.props.onUnmount(this.props.cellKey);\n  }\n\n  _onLayout = (nativeEvent: LayoutEvent): void => {\n    this.props.onCellLayout &&\n      this.props.onCellLayout(\n        nativeEvent,\n        this.props.cellKey,\n        this.props.index,\n      );\n  };\n\n  _renderElement(\n    renderItem: ?RenderItemType<ItemT>,\n    ListItemComponent: any,\n    item: ItemT,\n    index: number,\n  ): React.Node {\n    if (renderItem && ListItemComponent) {\n      console.warn(\n        'VirtualizedList: Both ListItemComponent and renderItem props are present. ListItemComponent will take' +\n          ' precedence over renderItem.',\n      );\n    }\n\n    if (ListItemComponent) {\n      /* $FlowFixMe[not-a-component] (>=0.108.0 site=react_native_fb) This\n       * comment suppresses an error found when Flow v0.108 was deployed. To\n       * see the error, delete this comment and run Flow. */\n      /* $FlowFixMe[incompatible-type-arg] (>=0.108.0 site=react_native_fb)\n       * This comment suppresses an error found when Flow v0.108 was deployed.\n       * To see the error, delete this comment and run Flow. */\n      return React.createElement(ListItemComponent, {\n        item,\n        index,\n        separators: this._separators,\n      });\n    }\n\n    if (renderItem) {\n      return renderItem({\n        item,\n        index,\n        separators: this._separators,\n      });\n    }\n\n    invariant(\n      false,\n      'VirtualizedList: Either ListItemComponent or renderItem props are required but none were found.',\n    );\n  }\n\n  render(): React.Node {\n    const {\n      CellRendererComponent,\n      ItemSeparatorComponent,\n      ListItemComponent,\n      debug,\n      fillRateHelper,\n      getItemLayout,\n      horizontal,\n      item,\n      index,\n      inversionStyle,\n      onCellFocusCapture,\n      renderItem,\n    } = this.props;\n    const element = this._renderElement(\n      renderItem,\n      ListItemComponent,\n      item,\n      index,\n    );\n\n    const onLayout =\n      (getItemLayout && !debug && !fillRateHelper.enabled()) ||\n      !this.props.onCellLayout\n        ? undefined\n        : this._onLayout;\n    // NOTE: that when this is a sticky header, `onLayout` will get automatically extracted and\n    // called explicitly by `ScrollViewStickyHeader`.\n    const itemSeparator = React.isValidElement(ItemSeparatorComponent)\n      ? ItemSeparatorComponent\n      : ItemSeparatorComponent && (\n          <ItemSeparatorComponent {...this.state.separatorProps} />\n        );\n    const cellStyle = inversionStyle\n      ? horizontal\n        ? [styles.rowReverse, inversionStyle]\n        : [styles.columnReverse, inversionStyle]\n      : horizontal\n      ? [styles.row, inversionStyle]\n      : inversionStyle;\n    const result = !CellRendererComponent ? (\n      <View\n        style={cellStyle}\n        onLayout={onLayout}\n        onFocusCapture={onCellFocusCapture}\n        /* $FlowFixMe[incompatible-type-arg] (>=0.89.0 site=react_native_fb) *\n        This comment suppresses an error found when Flow v0.89 was deployed. *\n        To see the error, delete this comment and run Flow. */\n      >\n        {element}\n        {itemSeparator}\n      </View>\n    ) : (\n      <CellRendererComponent\n        {...this.props}\n        style={cellStyle}\n        onLayout={onLayout}\n        onFocusCapture={onCellFocusCapture}>\n        {element}\n        {itemSeparator}\n      </CellRendererComponent>\n    );\n\n    return (\n      <VirtualizedListCellContextProvider cellKey={this.props.cellKey}>\n        {result}\n      </VirtualizedListCellContextProvider>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  row: {\n    flexDirection: 'row',\n  },\n  rowReverse: {\n    flexDirection: 'row-reverse',\n  },\n  columnReverse: {\n    flexDirection: 'column-reverse',\n  },\n});\n"],"mappings":"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"}