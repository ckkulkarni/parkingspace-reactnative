{"version":3,"names":["mock","useNavigation","jest","fn","mockReturnValue","navigate","goBack","calculateChargesMock","describe","mockFetch","originalFetch","global","fetch","space","beforeAll","mockResolvedValueOnce","ok","json","Promise","resolve","afterEach","resetAllMocks","afterAll","it","details","reg","time","Date","now","toISOString","route","params","render","getByTestId","timeSpentElement","console","log","props","children","expect","toHaveTextContent","parkingChargeElement","markSpaceAsUnoccupied","navigation","spaces","paymentButton","act","fireEvent","press","waitFor","toHaveBeenCalledWith","toHaveBeenCalled","goBackButton"],"sources":["PaymentScreen.test.tsx"],"sourcesContent":["import React from 'react';\r\nimport PaymentScreen from '../PaymentScreen';\r\nimport {render, waitFor, fireEvent} from '@testing-library/react-native';\r\nimport '@testing-library/jest-native/extend-expect';\r\nimport {NativeStackNavigationProp} from '@react-navigation/native-stack';\r\nimport {useNavigation} from '@react-navigation/native';\r\nimport {act} from 'react-test-renderer';\r\ndeclare var global: any;\r\njest.mock('@react-navigation/native', () => {\r\n  return {\r\n    useNavigation: jest.fn().mockReturnValue({\r\n      navigate: jest.fn(),\r\n      goBack: jest.fn(),\r\n    }),\r\n  };\r\n});\r\nconst calculateChargesMock = jest.fn();\r\ndescribe('Payment Screen/Deregister Parking', () => {\r\n  let mockFetch: jest.Mock;\r\n  const originalFetch = global.fetch;\r\n  const space = 1;\r\n  beforeAll(() => {\r\n    mockFetch = jest.fn().mockResolvedValueOnce({\r\n      ok: true,\r\n      json: () => Promise.resolve({}),\r\n    });\r\n    global.fetch = mockFetch;\r\n  });\r\n  afterEach(() => {\r\n    jest.resetAllMocks();\r\n  });\r\n  afterAll(() => {\r\n    global.fetch = originalFetch;\r\n  });\r\n  it('Displays the time spent', () => {\r\n    const details = {\r\n      reg: 'ABC123',\r\n      time: new Date(Date.now() - 60 * 60 * 1000).toISOString(),\r\n    };\r\n    const route = {params: {details}};\r\n    const {getByTestId} = render(<PaymentScreen route={route} />);\r\n    const timeSpentElement = getByTestId('deregester-time-spent');\r\n    console.log('timeSpentElement:', timeSpentElement.props.children[1]);\r\n    expect(timeSpentElement).toHaveTextContent('Time Spent: 1 hours 0 minutes');\r\n  });\r\n  it('Shows parking charge', () => {\r\n    const details = {\r\n      reg: 'ABC123',\r\n      time: new Date(Date.now() - 60 * 60 * 1000).toISOString(),\r\n    };\r\n    const route = {params: {details}};\r\n    const {getByTestId} = render(<PaymentScreen route={route} />);\r\n    const parkingChargeElement = getByTestId('deregester-charge');\r\n    expect(parkingChargeElement).toHaveTextContent('Parking Charges: $10');\r\n  });\r\n  it('calls markSpaceAsUnoccupied and navigates back to previous screen', async () => {\r\n    const markSpaceAsUnoccupied = jest.fn();\r\n    const navigation = {goBack: jest.fn()};\r\n    const route = {\r\n      params: {\r\n        details: {\r\n          reg: 'ABC123',\r\n          time: '2022-02-22T10:00:00.000Z',\r\n        },\r\n        space: 1,\r\n        spaces: [],\r\n        markSpaceAsUnoccupied,\r\n      },\r\n    };\r\n    const {getByTestId} = render(\r\n      <PaymentScreen route={route} navigation={navigation} />,\r\n    );\r\n    const paymentButton = getByTestId('deregester-payment-button');\r\n    await act(async () => {\r\n      fireEvent.press(paymentButton);\r\n      await waitFor(() => {\r\n        expect(markSpaceAsUnoccupied).toHaveBeenCalledWith(route.params.space);\r\n        expect(navigation.goBack).toHaveBeenCalled();\r\n      });\r\n    });\r\n  });\r\n  it('navigates back when the \"Go Back\" button is pressed', async () => {\r\n    const navigation = {\r\n      navigate: jest.fn(),\r\n      goBack: jest.fn(),\r\n    };\r\n\r\n    const route = {params: {details: {}, markSpaceAsUnoccupied: jest.fn()}};\r\n    const {getByTestId} = render(\r\n      <PaymentScreen route={route} navigation={navigation} />,\r\n    );\r\n    const goBackButton = getByTestId('deregester-back');\r\n    console.log(goBackButton);\r\n    fireEvent.press(goBackButton);\r\n    expect(navigation.goBack).toHaveBeenCalled();\r\n  });\r\n});\r\n"],"mappings":"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"}